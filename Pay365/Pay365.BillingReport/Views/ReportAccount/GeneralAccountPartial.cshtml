@model List<DataAccess.ReportAPI.DTO.AccountReport>

@if (ViewBag.Role == -1)
{
    <script type="text/javascript">
        $(document).ready(function () {
            window.location = UrlRoot + "Account/FormLogin";
        });
    </script>
}
else if (ViewBag.Role == -2)
{
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="col-lg-12">
                <div class="centering text-center error-container">
                    <div class="text-center">
                        <h2 class="without-margin">Don't worry. It's <span class="text-warning"><big>403</big></span> error only.</h2>
                        <h4 class="text-warning">Access denied</h4>
                    </div>
                    <div class="text-center">
                        <h3><small>Choose an option below</small></h3>
                    </div>
                    <hr>
                    <ul class="pager">
                        <li><a href="@Html.Raw(Pay365.Utils.Config.Domain)">&larr; Home</a></li>
                        <li><a href="@Html.Raw(ViewBag.UrlLogin)?act=out" style="color:#005bff; font-size:13px;text-decoration:underline">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


}
else
{
    int TotalRegisterWeb = 0;
    int TotalRegisterApp = 0;
    int TotalActiveWeb = 0;
    int TotalActiveApp = 0;
    int TotalRegisterPersonal = 0;
    int TotalRegisterEnterprise = 0;
    int TotalActivePersonal = 0;
    int TotalActiveEnterprise = 0;
    int TotalVerifyEmail = 0;
    int TotalAuthenAccount = 0;
    int TotalODPSMS = 0;
    int TotalODPEmail = 0;
    int TotalOTPApp = 0;
    int TotalOTPMatrix = 0;
    int TotalSecure = 0;
    <div class="clearfix"></div>
    <div class="table-responsive">
        <table class="table table-striped table-hover dataTable no-footer" style="width:100%" id="table-static">
            <thead>

                <tr class="info">
                    <th style="width:10%;" rowspan="4">Thời gian</th>
                    <th style="width:50%;" colspan="8">Đăng Ký tài khoản</th>
                    <th style="width:7%;" rowspan="4">Xác thực email </th>
                    <th style="width:7%;" rowspan="4">Chức thực tài khoản</th>
                    <th style="width:25%;" colspan="5">Bảo mật</th>
                </tr>
                <tr class="info">
                    <th colspan="2">Web</th>
                    <th colspan="2">App</th>
                    <th colspan="4">Tổng</th>
                    <th rowspan="3">ODP SMS</th>
                    <th rowspan="3">ODP Email</th>
                    <th rowspan="3">OTP App</th>
                    <th rowspan="3">OTP Matrix</th>
                    <th rowspan="3">Tổng</th>
                </tr>
                <tr class="info">
                    <th rowspan="2">Đăng ký</th>
                    <th rowspan="2">Kích hoạt</th>
                    <th rowspan="2">Đăng ký</th>
                    <th rowspan="2">Kích hoạt</th>
                    <th colspan="2">Đăng ký</th>
                    <th colspan="2">Kích hoạt</th>
                </tr>
                <tr class="info">
                    <th>Cá nhân</th>
                    <th>Doanh nghiệp</th>
                    <th>Cá nhân</th>
                    <th>Doanh nghiệp</th>
                </tr>
            </thead>

            <tfoot>
                @if (Model != null && Model.Count > 0)
                {
                    TotalRegisterWeb = Model.Sum(c => c.AccountRegisterWeb);
                    TotalRegisterApp = Model.Sum(c => c.AccountRegisterApp);
                    TotalRegisterPersonal = Model.Sum(c => c.AccountRegisterPersonal);
                    TotalRegisterEnterprise = Model.Sum(c => c.AccountRegisterEnterprise);
                    TotalActiveWeb = Model.Sum(c => c.AccountActiveWeb);
                    TotalActiveApp = Model.Sum(c => c.AccountActiveApp);
                    TotalActivePersonal = Model.Sum(c => c.AccountActivePersonal);
                    TotalActiveEnterprise = Model.Sum(c => c.AccountActiveEnterprise);
                    TotalVerifyEmail = Model.Sum(c => c.AccountEmailVerified);
                    TotalAuthenAccount = Model.Sum(c => c.AccountVerified);
                    TotalODPSMS = Model.Sum(c => c.AccountODPSMS);
                    TotalODPEmail = Model.Sum(c => c.AccountODPEmail);
                    TotalOTPApp = Model.Sum(c => c.AccountOTPApp);
                    TotalOTPMatrix = Model.Sum(c => c.AccountOTPMatrix);
                    TotalSecure = TotalODPSMS + TotalOTPApp + TotalODPEmail + TotalOTPMatrix;
                    <tr>
                        <td align="right" style="text-align:right" valign="middle">
                            <b>Tổng số</b>
                        </td>
                        <td style="text-align:right"><b>@((TotalRegisterWeb == 0) ? TotalRegisterWeb.ToString() : string.Format("{0:##,###}", TotalRegisterWeb).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalActiveWeb == 0) ? TotalActiveWeb.ToString() : string.Format("{0:##,###}", TotalActiveWeb).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalRegisterApp == 0) ? TotalRegisterApp.ToString() : string.Format("{0:##,###}", TotalRegisterApp).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalActiveApp == 0) ? TotalActiveApp.ToString() : string.Format("{0:##,###}", TotalActiveApp).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalRegisterPersonal == 0) ? TotalRegisterPersonal.ToString() : string.Format("{0:##,###}", TotalRegisterPersonal).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalRegisterEnterprise == 0) ? TotalRegisterEnterprise.ToString() : string.Format("{0:##,###}", TotalRegisterEnterprise).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalActivePersonal == 0) ? TotalActivePersonal.ToString() : string.Format("{0:##,###}", TotalActivePersonal).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalActiveEnterprise == 0) ? TotalActiveEnterprise.ToString() : string.Format("{0:##,###}", TotalActiveEnterprise).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalVerifyEmail == 0) ? TotalVerifyEmail.ToString() : string.Format("{0:##,###}", TotalVerifyEmail).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalAuthenAccount == 0) ? TotalAuthenAccount.ToString() : string.Format("{0:##,###}", TotalAuthenAccount).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalODPSMS == 0) ? TotalODPSMS.ToString() : string.Format("{0:##,###}", TotalODPSMS).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalODPEmail == 0) ? TotalODPEmail.ToString() : string.Format("{0:##,###}", TotalODPEmail).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalOTPApp == 0) ? TotalOTPApp.ToString() : string.Format("{0:##,###}", TotalOTPApp).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalOTPMatrix == 0) ? TotalOTPMatrix.ToString() : string.Format("{0:##,###}", TotalOTPMatrix).Replace(",", "."))</b></td>
                        <td style="text-align:right"><b>@((TotalSecure == 0) ? TotalSecure.ToString() : string.Format("{0:##,###}", TotalSecure).Replace(",", "."))</b></td>
                    </tr>

                }
            </tfoot>

        </table>
    </div>

    <script type="text/javascript">

    $(document).ready(function () {
        var listjson = '@Html.Raw(ViewBag.listjson)';
        var datajson = JSON.parse(listjson);
        var table = $('#table-static').DataTable({
            dom: 'Bf<"chooseChart">tp',
            lengthMenu: [
                    [10, 25, 50],
                    ['10 rows', '25 rows', '50 rows']
            ],
            "data": datajson,
            "columns": [
                   { "data": "ReportDate" },
                   { "data": "AccountRegisterWeb" },
                   { "data": "AccountActiveWeb" },
                   { "data": "AccountRegisterApp" },
                   { "data": "AccountActiveApp" },
                   { "data": "AccountRegisterPersonal" },
                   { "data": "AccountRegisterEnterprise" },
                   { "data": "AccountActivePersonal" },
                   { "data": "AccountActiveEnterprise" },
                   { "data": "AccountEmailVerified" },
                   { "data": "AccountVerified" },
                   { "data": "AccountODPSMS" },
                   { "data": "AccountODPEmail" },
                   { "data": "AccountOTPApp" },
                   { "data": "AccountOTPMatrix" },
                   { "data": "TotalSecure" }
            ],
            buttons: [
                    {
                        extend: 'collection',
                        text: "<i class='fa fa-cloud-download'></i>Xuất dữ liệu",
                        buttons: [
                            {
                                extend: 'copy',
                                exportOptions: {
                                    columns: ':visible'
                                },
                                text: "<i class='fa fa-copy'></i>Copy",
                                footer: true,
                                title: "Báo Cáo Tổng Hợp Tài Khoản"
                            },
                            {
                                extend: 'csvHtml5',
                                text: "<i class='fa fa-file-text-o'></i>Csv",
                                exportOptions: {
                                    columns: ':visible'
                                },
                                footer: true,
                                title: "Báo Cáo Tổng Hợp Tài Khoản"
                            },
                            {
                                extend: 'excelHtml5',
                                text: "<i class='fa fa-file-excel-o'></i>Excel",
                                exportOptions: {
                                    columns: ':visible'
                                },
                                footer: true,
                                title: "Báo Cáo Tổng Hợp Tài Khoản",
                                filename: "Báo Cáo Tổng Tài Khoản",
                                typeTime: 0
                            },
                            {
                                extend: 'excelHtml5',
                                text: "<i class='fa fa-file-word-o'></i>Word",
                                exportOptions: {
                                    columns: ':visible'
                                },
                                doctype: 'doc',
                                footer: true,
                                title: "Báo Cáo Tổng Hợp Tài Khoản",
                                filename: "Báo Cáo Tổng Tài Khoản",
                                typeTime: 0
                            },
                            {
                                extend: 'pdfHtml5',
                                text: "<i class='fa fa-file-pdf-o'></i>PDF",
                                exportOptions: {
                                    columns: ':visible'
                                },
                                pageSize: 'A4',
                                footer: true,
                                title: "Báo Cáo Tổng Hợp Tài Khoản",
                                typeTime: 0
                            },
                            {
                                extend: 'print',
                                text: "<i class='fa fa-print'></i>Print",
                                autoPrint: false,
                                footer: true,
                                title: "Báo Cáo Tổng Hợp Tài Khoản",
                                typeTime: 0
                            }
                        ]
                    },

                    'pageLength',
                    {
                        extend: "colvis",
                        text: "<i class='fa fa-eye-slash'></i>Ẩn/hiện cột"
                    }
            ],
            "bAutoWidth": true,
            "aaSorting": [[0, 'desc']],
            "bSort": true,
            "fnDrawCallback": function (oSettings) {
                rowspanDTable(oSettings, "table-static", '0');
            },
            searching: false,
            pageLength: 25,
            reponsive: true
        });
        table.buttons().container().appendTo('#example_wrapper .col-sm-6:eq(0)');
        $('#table-static').on('page.dt', function () {
            $("html,body").animate({ scrollTop: $('#table-static').offset().top - 100 }, 'fast');
        });
        Highcharts.setOptions({
            colors: ['#4572A7', '#AA4643', '#89A54E', '#80699B', '#3D96AE', '#DB843D', '#92A8CD', '#A47D7C', '#B5CA92'],
        });
        
        ChartAccount();

        $("#ddlTypeData").change(function () {
            var typeData = parseInt($(this).val());
            $("#ddlSelectChart").empty();
            var html = '<option value="0">Không hiển thị</option><option value="1">Biểu đồ Line</option><option value="2">Biểu đồ Pie</option>';
            if (typeData == 4 || typeData == 5) {
                html = '<option value="0">Không hiển thị</option><option value="1">Biểu đồ Line</option>';
            }
            else if (typeData == 0)
            {
                html = '<option value="0">Không hiển thị</option>';
            }
            $("#ddlSelectChart").html(html);

            switch (typeData) {
                case 1: //TK đăng ký
                    seriePie = [
                        {
                            name: "Môi trường",
                            colorByPoint: true,
                            data: [
                               ["WEB", parseInt('@TotalRegisterWeb')],
                               ["APP", parseInt('@TotalRegisterApp')]
                            ],
                            center: [350, 150],
                            size: "50%",
                            colors: ['#4572A7', '#2f7ed8', '#8bbc21', '#910000', '#1aadce',
   '#492970', '#f28f43', '#77a1e5', '#c42525', '#a6c96a'],
                            showInLegend: false
                        },
                        {
                            name: "Loại Tài Khoản",
                            colorByPoint: true,
                            data: [
                                ["Cá nhân", parseInt('@TotalRegisterPersonal')],
                                ["Doanh nghiệp", parseInt('@TotalRegisterEnterprise')]
                            ],
                            center: [850, 150],
                            size: "50%",
                            colors: ['#8085e9', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'],
                            showInLegend: false
                        }
                    ];

                    if (screen && screen.width <= 768) {
                        seriePie[0].center = [150, 110];
                        seriePie[1].center = [150, 280];
                    }
                    break;
                case 2://loại TK kích hoạt
                    seriePie = [
                        {
                            name: "Môi trường",
                            colorByPoint: true,
                            data: [
                               { name: "WEB", y: parseInt('@TotalActiveWeb') },
                               { name: "APP", y: parseInt('@TotalActiveApp') }
                            ],
                            center: [350, 150],
                            size: "50%",
                            colors: ['#7cb5ec', '#2f7ed8', '#8bbc21', '#910000', '#1aadce',
   '#492970', '#f28f43', '#77a1e5', '#c42525', '#a6c96a'],
                            showInLegend: false
                        },
                            {
                                name: "Loại Tài Khoản",
                                colorByPoint: true,
                                data: [
                                   { name: "Cá nhân", y: parseInt('@TotalActivePersonal') },
                                   { name: "Doanh nghiệp", y: parseInt('@TotalActiveEnterprise') }
                                ],
                                center: [850, 150],
                                size: "50%",
                                colors: ['#2f7ed8', '#f45b5b'],
                                showInLegend: false
                            }
                    ];
                    break;
                case 3:
                    seriePie = [
                        {
                            name: "Đăng ký Bảo mật",
                            colorByPoint: true,
                            data: [
                               { name: "ODP SMS", y: parseInt('@TotalODPSMS') },
                               { name: "ODP Email", y: parseInt('@TotalODPEmail') },
                               { name: "OTP App", y: parseInt('@TotalODPSMS') },
                               { name: "OTP Matrix", y: parseInt('@TotalODPEmail') }
                            ]
                        }
                    ];
                    break;
                default:
                    break;
            }
        });
        
    });

</script>

}